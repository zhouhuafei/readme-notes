# 微信开发者工具
* 编译模式，定格在某一个页面时，启动参数设置成：?id=3549。导致一直报错
    - 解决方案，去掉问号(?)。

# 跳转
* wx.navigateTo
    - 保留当前页面，跳转到应用内的某个页面，使用wx.navigateBack可以返回到原页面。
* wx.redirectTo
    - 关闭当前页面，跳转到应用内的某个页面。
* wx.reLaunch
    - 关闭所有页面，打开到应用内的某个页面。
* wx.switchTab
    - 跳转到 tabBar 页面，并关闭其他所有非 tabBar 页面。

# 页面之间传值
* 方式1
```
// 在首页，使用api跳转到详情页
wx.navigateTo('/pages/detail/detail/?id=1');
// 在详情页页面中的onLoad方法中接收
Page({
    onLoad(query) {
        console.log('接收数据', query)；
    },
});
```
* 方式2
```
// app.js里定义一个全局变量。
App({
    globalData: {},
});
// 跳转到别的页面的时候，可以更改这个值。
const app = getApp();
app.globalData.key1 = 'value1';
// 在其他页面就可以拿到这个值了。
const app = getApp();
console.log('数据', app.globalData.key1);
```
* 方式3
```
// 通过本地存储，跳转页面之前设置一个值。
wx.setStorage('key1', 'value1'); // 异步的
wx.setStorageSync('key1', 'value1'); // 同步的
// 到另外一个页面时，再接收这个值。
wx.getStorage('key1', 'value1'); // 异步的
wx.getStorageSync('key1', 'value1'); // 同步的
```

# 事件传参
```
// wxml
<view bindtap="fnClick" data-id="123"></view>
// js
Page({
    fnClick(ev) {
        console.log('数据', ev.currentTarget.dataset.id);
    },
});
```

# 定时器
* 页面卸载要清理掉定时器，否则会导致报错（以前会导致报错）。如果不清理掉，定时器会一直走着。

# WebStorm 格式化
* WebStorm 格式化wxss文件时，导致数值和单位之间有空格，正常应该是20rpx，编辑器格式化成了20 rpx导致无效。
    - 解决方案，不格式化，或者使用sass工具，封装个函数去转义。
    ```
    @function px2rpx($px) {
      @return $px * 1rpx;
    }
    ```

# 针对某一个页面进行下拉刷新
* index.json里加上window:{enablePullDownRefresh:true}，下拉刷新无效。
    - 解决方案：需要注意的是在需要下拉刷新的页面设置json时，直接写enablePullDownRefresh属性就行了，不需要写window。
* 下拉刷新，重新执行onLoad，组件内部数据没更新。
    - 解决方案：先把数据变成空，然后再重新赋值。然后关闭下拉刷新。wx.stopPullDownRefresh();

* canvas 让px可以自适应，原理就是等比缩放。
```
function px2px(px) {
    return px * wx.getSystemInfoSync().windowWidth / 375; // 设计图是375的
}
```

* canvas转图片时：1、canvas里用wx.drawImage插入的图片，真机本地预览进行测试，发现图片不显示。2、导出的图片变形了。3、导出的图片没有背景色。
    - 1、解决方案之wx.drawImage插入的图片，真机本地预览进行测试，发现图片不显示：
        - 1、图片需要是本地图片。
        - 2、不支持svg格式。
        - 3-1、远程图片需要下载到本地 可以使用wx.downloadFile方法或者wx.getImageInfo方法。
        - 3-2、远程图片仅支持https协议的图片。
        - 3-3、开发者工具，预览时用真机是无效的，远程调试时用真机是有效的。
    - 2、解决问题之宽高不对：
        - 1、因为wx.canvasToTempFilePath方法导出的图片默认宽高是小程序去掉顶部菜单的宽高（如果画布的宽高不是这个比例，则导出的图片会变形），应该设置成画布的宽高乘以对应的倍数，先3倍吧。
        - 2、然后再配合wx.saveImageToPhotosAlbum方法进行导出。
    - 3、解决方案之背景色无效：因为我使用的是css的背景色，所以无效，背景色应该也要使用canvas绘画出来。
