## 文档
* 官方文档：https://qiankun.umijs.org/zh/guide
* 官方API文档：https://qiankun.umijs.org/zh/api
* 源码地址：https://github.com/umijs/qiankun
* 案例地址：https://github.com/umijs/qiankun/tree/master/examples

## 场景
* 主应用技术栈：Vue2全家桶
* 子应用技术栈：Vue3全家桶

## 全局变量会互串么？
> 不会互串，js有沙箱机制，所以各个应用之间的js是互相隔离的。
* 经测试发现，主应用中定义的全局变量，子应用可以直接使用。
* 子应用中定义的全局变量，其他子应用以及主应用不能直接使用。

## store会串么？
> 不会互串，js有沙箱机制，所以各个应用之间的js是互相隔离的。
* vue调试工具中，只能看到主应用的store。
* 但是在代码中，子应用自身可以读取到自身的store。
#### 子应用如何读取主应用的store？
TODO

## 主应用和子应用怎么通讯？
TODO

## js沙箱机制的原理？css沙箱机制的原理？
https://zhuanlan.zhihu.com/p/414468874

## 全局css会互串么？
* 经测试发现，主应用中定义的全局css，可以影响到子应用。
* 子应用中定义的全局css，也可以影响到主应用以及其他子应用。
  - 注意：当对应的子应用被卸载后，则影响直接消失。
  - 本质：本质是style标签也被移除了。style标签被移除则对应的样式会消失。
  - 引申：link标签被移除样式会消失么？link标签被移除则对应的样式也会消失。
  - 但是：qiankun为了做css沙箱，通过fetch把link中的内容转成了style进行渲染。
* 案例：主应用使用了一份阿里字体图标，子应用也使用了一份阿里字体图标。
  - 问题：子应用的字体图标，会对主应用的字体图标产生影响，导致主应用的字体图标展示错乱。
  - 建议：子应用不单独使用字体图标，子应用使用主应用的字体图标。

## css沙箱机制的种类？
* 方案1：使用`shadow DOM`进行隔离：简单讲就是在当前微应用的根节点开启`shadow`，然后子节点的操作都是在`shadowRoot`上来进行隔离。
  - `shadow DOM`文档：https://developer.mozilla.org/zh-CN/docs/Web/Web_Components/Using_shadow_DOM
* 方案2：使用`css域`进行隔离：为每个css规则添加特定的前缀来起到隔离的作用，例如微应用中的样式是`p{color:#000;}`，处理后为`.app1 p{color:#000;}`。
## css沙箱机制不是万能药
> css沙箱机制需要在主应用中手动开启！
```javascript
// strictStyleIsolation: true // 使用`shadow DOM`进行隔离
// experimentalStyleIsolation: true // 使用`css域`进行隔离
start({ sandbox: { experimentalStyleIsolation: true } })
```
* 上述两种css沙箱机制，无法完全隔离全局样式。主应用中的全局样式，多多少少都会影响到子应用。
* 所以在使用微前端框架写代码时，css相关的地方，还需要自行注意。建议通过约定，使命名规范化。
* 我的选择：上述两种沙箱机制，我使用的方案2。因方案1无法使用字体图标。
  - 不管是主应用的字体图标，还是子应用自身引入的字体图标（不管是以何种方式引入），方案1都无法使用。
  - 使用方案2时，如果子应用单独引入字体图标，依然会存在和主应用字体图标冲突的问题。
  - 官网上有下述这么一句话，可以用来解释这种现象存在的原因。
  > 注意: `@keyframes`、`@font-face`、`@import`、`@page`将不被支持(i.e. 不会被改写)

## 主应用设置404会影响子应用么？
* 主应用设置404会影响子应用。
#### 主应用404了怎么处理？
TODO
#### 子应用404了怎么处理？
* 不处理！

## 路由跳转
* 主应用跳子应用，使用`router.push`进行跳转时，只能用`path`，不能用`name`。
* 因为在主应用中，不存在子应用对应的路由配置。
  - 想想草动商城管理系统的左侧菜单栏。
  - 如果在主应用路由中，把子应用路由，配置成空模板组件，理应可以使用`name`进行跳转。

## 子应用部署方案？
* 主应用中注册子应用的部分，`entry`需要根据环境的不同，配置成动态的。
#### 方案1：子应用使用独立域名？
* 因qiankun框架，是基于fetch拉取子应用。而独立域名存在跨域问题，所以需要配置跨域。
#### 方案2：子应用使用二级路由？
* 不需要配置跨域。
#### 方案采用：采用方案2！
* 因没有额外的独立域名或二级域名，所以我准备采用方案2。
* 在nginx配置处，额外增加一条代理规则，实现二级路由的拦截。

## h5的微前端？
* h5的微前端直接用nginx进行二级路由的反向代理即可。
* 独立的流程（流程自身闭环）做成独立的项目即可。
* 例如来伊份的员工佣金提现流程和员工端基础功能就是分开的两个项目，分别部署在了两台不同的服务器上。
