# 浏览器输入图片链接，直接下载图片。
* 'Content-Type': 'application/octet-stream'
    - 是以流的形式下载文件,这样可以实现任意格式的文件下载。
* 'Content-Disposition': 'attachment; filename=' + fileName
    - 第一个值表示：以什么方式下载，如attachment为以附件方式下载。
    - 第一个值表示：默认保存时的文件名。

# 浏览器输入图片链接，直接显示图片。
* 'Content-Type': 'image/png'

# 浏览器输入图片链接，直接显示字符串形式的数据。
* 'Content-Type': 'application/json'

# 总结
* 1、服务端响应的都是二进制数据流。
* 2、指定Content-Type让浏览器(客户端)能识别即可。
    - 识别为图片则显示图片。
    - 识别不了则直接把数据流以乱码的形式展示。
    - 识别为下载类型的文件，则把文件下载下来。
* 3、忽略客户端的场景，想一下如果是服务端之间互相通信即可理明白。都是数据之间互相通信罢了。

# 客户端上传多张图片时是怎么上传的？服务端又是怎么接收的？
* 客户端 - `FormData`
```
<input type="file" multiple>
<script>
async function onChange (e) {
  const formData = new FormData()
  formData.append('a', '1')
  formData.append('b', '2')
  formData.append('c', '3')
  formData.append('file', e.target.files[0]) // 多张图片要多个键值对，后端也是多个键值对接收，建议多次打接口。
  // formData.append('file2', e.target.files[1]) // 多张图片要多个键值对，后端也是多个键值对接收，建议多次打接口。
  const res = await axios({
    method: 'post',
    url: 'http://127.0.0.1:3000/upload',
    data: formData
  })
  console.log(res)
}

document.querySelector('input').addEventListener('change', onChange)
</script>
```
* 服务端 - `koa-body`
```
const fs = require('fs')

module.exports = (ctx, next) => {
  const req = ctx.request
  const body = req.body // multipart/form-data 类型的普通数据
  const file = req.files.file //  multipart/form-data 类型的文件数据(文件被上传到服务器之后的数据，其中包含文件在服务端的存储路径和文件大小等)
  // const file2 = req.files.file2 //  multipart/form-data 类型的文件数据(文件被上传到服务器之后的数据，其中包含文件在服务端的存储路径和文件大小等)
  ctx.body = { hello: 'upload' }
}
```

# nodejs 服务A把图片传递给服务B
* 注：nodejs无`FormData`对象。可使用：https://github.com/form-data/form-data 包模拟。
```
const fs = require('fs')
const axios = require('axios')
const FormData = require('form-data')

module.exports = (ctx, next) => {
  const req = ctx.request
  const body = req.body // multipart/form-data 类型的普通数据
  const file = req.files.file //  multipart/form-data 类型的文件数据(文件被上传到服务器之后的数据，其中包含文件在服务端的存储路径和文件大小等)
  // 从本服务器把图片上传到另外一台服务器。
  return new Promise(async (resolve) => {
    const fileData = fs.createReadStream(file.path)
    const formData = new FormData()
    formData.append('a', '1')
    formData.append('b', '2')
    formData.append('c', '3')
    formData.append('file', fileData) // 多张图片要多个键值对，后端也是多个键值对接收，建议多次打接口。
    await axios({
      method: 'post',
      url: 'http://127.0.0.1:3001/upload',
      headers: formData.getHeaders(), // 必不可少
      data: formData
    })
    ctx.body = { hello: 'upload' }
    resolve(next())
  })
}
```
