# 一个允许任何来源请求的api服务器怎么做权限验证
* 首先网站要允许被跨域请求 Access-Control-Allow-Origin: *

# 过滤一部分不合法来源的请求
* 接口验签（这里的接口验签只是防止别人拿到接口一直请求罢了。如果别人破解了验签的加密方式，依然是可以重复打接口的。）

# token
* 登录，后端会返回utoken和uid。
* 后续请求带上utoken和uid即可。
    - 因为跨主域cookie带不过去，所以绑定到cookie上只是方便前端后续拿token，带给后端是带不过去的。
    - token的有效时间应该要和后端确认，对应的cookie也要存对应的时长。
* https://www.cnblogs.com/pingfan1990/p/4905065.html

# 后端生成token的原理
* 待续...

# token的存储
* 待续...

# token的更新
* 待续...

# token的安全性
* 别人拿到token和uid，也就拿到了登录权限。
* 不跨主域，可以把token存cookie里，加上httponly，会相对安全很多。

# token的弊端
* 没有中间层做代理，token验证权限无法做登录注册的图文验证码，因为没有sessionid关联，无法识别图文验证码的归属。
    - 生成图片验证码的时候，可以生成一个当前验证码对应的token存储到redis上。
    - 如此可以生成图文验证码。但是生成多了是否会导致redis爆掉？这个犹未可知。所以过期时间尽量设置短一点。1-2分钟即可。

# session
* 只要不跨主域，是可以把登录状态保存到session上的，所以没问题。
* 本地开发的时候可以使用服务器代理，此时session也是可以传回来的。所以是可以进行登录的。
    - 登录之后如果请求接口是可以正常请求的，因为有session。
    - 但是页面静态化了，路由前端控制了，因为没有记录登录状态，所以此时，本地开发是没办法做没登录自动跳转路由的。
    - 解决方案，登录之后记一个cookie，退出删除这个cookie，修改密码重置密码都要删除这个cookie让用户重新登录，或者不处理，等接口返回未登录状态然后再自动跳转路由，或者每次切换路由都打一下是否登录了的接口。
* 如果跨主域了，那就没办法了，因为服务端返响应的set-cookie没办法跨主域设置到浏览器里的，除非线上你也使用了服务器代理。
* sessionid要想跨子域，需要设置cookie时，domian前面要加上一个点(.)。
* 总结：跨主域关联sessionid需要使用服务器代理。
