# jwt怎么刷新token？
* token即将过期的前5分钟，带着尚未过期的token来换取新的token。并更新用户信息表里记录的登录戳来保证本次登录token的唯一性，并可以让老的token无效。
* 失效其实是假失效。token的验证还是可以通过的。不过登录戳的验证就通不过了。所以可以保证token的唯一性。
* 打了更新token的接口之后。客户端的token也要更新。

# 刷新token的细节
* 应该在请求成功且业务成功之后，然后判断token是否快要过期了。如果快要过期了。就刷新token。刷新失败则提示token过期了。
    - 可能存在的问题：暂时无解。
    - 过期之前，如果客户端并发了两个请求。
    - 因每次刷新token的请求，都会改变登陆戳，让token过期。
    - 所以会导致后请求的那个会返回token无效。
    - 临时解决方案：客户端不要并发请求(异步)。应该等一个请求结束了，再进行另外一个请求(同步)。
* 登陆戳：
    - jsonwebtoken生成新token，老token如果还没过期，是可以继续使用的。
    - 所以使用登陆戳进行校验可以让老token验证通不过。
    - 登陆戳我是存在user表中的。每次登录都修改登陆戳。
    - 登陆戳也可以用来做单设备登录。
* 注意：
    - 刷新token的时候。
    - 如果走的是一个新的ajax。则需要单独处理错误以及验签等。所以建议下面这个。然后加参数控制。
    - 如果走的是封装好的ajax(封装好的里面进行了刷新token的处理，错误处理，验签处理等。如果继续走的话，相当于递归调用了)。则需要判断如果当前是打的是刷新token的接口。则成功的回调里不应该再次刷新token。
    - 建议参数名为isRefreshToken。当这个参数为false时就不刷新token。刷新token的请求里把这个参数设置成false即可。

# 刷新token并发的解决方案
* 如果需要刷新token了。则先刷新token。token刷新完毕之后才触发当前的这次请求。
* 如此即使在即将过期的时间段客户端并发了多条请求也没关系。顶多会多次刷新token。不会导致第二次请求直接报token无效。
